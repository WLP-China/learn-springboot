<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
</head>
<body>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>订单详情</legend>
</fieldset>
<blockquote class="layui-elem-quote">
    <!--
    <button type="button" class="layui-btn layui-btn-sm">默认按钮</button>
    <button type="button" class="layui-btn layui-btn-sm layui-btn-normal">百搭按钮</button>
    <button type="button" class="layui-btn layui-btn-sm layui-btn-warm">暖色按钮</button>
    <button type="button" class="layui-btn layui-btn-sm layui-btn-danger">警告按钮</button>
    <button type="button" class="layui-btn layui-btn-sm layui-btn-disabled">禁用按钮</button>
-->
    <span>订单状态：</span><span id="status" style="color: orangered"></span>
    <button type="button" class="layui-btn layui-btn-sm layui-btn-primary" style="float: right"
            onclick="location.href='orderList.html'">返回
    </button>
    <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" style="float: right;margin-right: 10px"
            onclick="location.href='addSeller.html?&orderId='+getUrlParam('id')" permission="order:addseller">审核
    </button>

</blockquote>
<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">订单信息</div>
                <div class="layui-card-body">
                    <div class="layui-form">
                        <table class="layui-table">
                            <colgroup>
                                <col width="150">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td>需方单位</td>
                                <td id="buyerEnterprise"></td>
                            </tr>
                            <tr>
                                <td>工程名称</td>
                                <td id="proname"></td>
                            </tr>
                            <tr>
                                <td>施工部位</td>
                                <td id="position"></td>
                            </tr>
                            <tr>
                                <td>订单量(预计用量)</td>
                                <td id="nunOrder"></td>
                            </tr>
                            <tr>
                                <td>添加剂</td>
                                <td id="concreteAdditive"></td>
                            </tr>
                            <tr>
                                <td>混凝土型号</td>
                                <td id="concreteType"></td>
                            </tr>
                            <tr>
                                <td>抗渗压等级</td>
                                <td id="concreteLevel"></td>
                            </tr>
                            <tr>
                                <td>泵送方式</td>
                                <td id="pumpingType"></td>
                            </tr>
                            <tr>
                                <td>是否财政项目</td>
                                <td id="isFinance"></td>
                            </tr>
                            <tr>
                                <td>结算方式</td>
                                <td id="payType"></td>
                            </tr>
                            <tr>
                                <td>浇筑时间</td>
                                <td id="sendTime"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">发货信息</div>
                <div class="layui-card-body">
                    <!--                    结合 layui 的栅格系统<br>-->
                    <!--                    轻松实现响应式布局-->
                    <div class="layui-form" id="order_sellers">
                        <!--
                        <table class="layui-table">
                            <colgroup>
                                <col width="150">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td>供方单位</td>
                                <td id="sellerEnterprise"></td>
                            </tr>
                            <tr>
                                <td>发货量</td>
                                <td id="numCend"></td>
                            </tr>
                            <tr>
                                <td>监站人员</td>
                                <td id="pJianzhan"></td>
                            </tr>
                            <tr>
                                <td>司机</td>
                                <td id="pDriver"></td>
                            </tr>
                            </tbody>
                        </table>-->
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md12"></div>
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">需方确认信息</div>
                <div class="layui-card-body">
                    <div class="layui-form">
                        <table class="layui-table">
                            <colgroup>
                                <col width="150">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td>接收量</td>
                                <td id="numReceive"></td>
                            </tr>
                            <tr>
                                <td>接收人</td>
                                <td id="pReceive"></td>
                            </tr>
                            <tr>
                                <td>旁站人</td>
                                <td id="pPangzhanA"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!--
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">供方确认信息</div>
                <div class="layui-card-body">
                    <div class="layui-form">
                        <table class="layui-table">
                            <colgroup>
                                <col width="150">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td>旁站人</td>
                                <td id="pPangzhanB"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        -->
        <!--
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">标题</div>
                <div class="layui-card-body">
                    内容
                </div>
            </div>
        </div>-->
    </div>
</div>

<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>


<script type="text/javascript">
    layui.use('layer', function () {
        var layer = layui.layer;
    });

    initData();

    function initData() {
        var orderId = getUrlParam("id");

        if (isNotEmpty(orderId)) {
            $.ajax({
                type: 'get',
                url: '/order/' + orderId,
                async: false,
                success: function (data) {
                    console.log(data)
                    // $("#id").val(data.id);
                    $("#buyerEnterprise").text(data.buyerEnterprise);
                    $("#proname").text(data.proname);
                    $("#position").text(data.position);
                    $("#nunOrder").text(data.nunOrder + " m³");
                    $("#concreteAdditive").text(data.concreteAdditive);
                    $("#concreteType").text(data.concreteType);
                    $("#concreteLevel").text(data.concreteLevel);
                    $("#pumpingType").text(data.pumpingType);
                    $("#sendTime").text(data.sendTime);
                    $("#isFinance").text(data.isFinance);
                    $("#payType").text(data.payType);

                    let status = data.status;
                    let status_arr = ["未知状态", "待审核", "待发货", "已发货", "已签收", "已完成"];
                    $("#status").text(status_arr[status]);

                    if (status != 1) {
                        let str = '<table class="layui-table"><colgroup><col width="150"><col></colgroup><tbody><tr><td>供方单位</td><td>'+data.sellerEnterprise+'</td></tr></tbody></table>'
                        $("#order_sellers").html(str);
                    }
                    if (status != 1 && status != 2) {
                        let str = '<table class="layui-table"><colgroup><col width="150"><col></colgroup><tbody><tr><td>供方单位</td><td>'+data.sellerEnterprise+'</td></tr></tbody></table>'

                        var orderSellerList = data.orderSellerList;
                        $.each(orderSellerList,function(index,value){
                            let p_jz = JSON.parse(value.pJianzhan);
                            str = str + '<table class="layui-table"><colgroup><col width="150"><col></colgroup><tbody><tr><td>订单号</td><td>'+value.no+'</td></tr><tr><td>发货量</td><td>'+value.numCend+' m³</td></tr><tr><td>监站人员</td><td>'+p_jz.name+'('+p_jz.phone+')</td></tr><tr><td>发货时间</td><td>'+value.createTime+'</td></tr></tbody></table>';
                        });

                        $("#order_sellers").html(str);

                        // let p_driver = JSON.parse(data.pDriver);
                        // $("#numCend").text(data.numCend + " m³");
                        // $("#pJianzhan").text(p_jz.name + "(" + p_jz.phone + ")");
                        // $("#pDriver").text(p_driver.name + "(" + p_driver.phone + ")");
                    }
                    if (status == 4 || status == 5) {
                        let p_receive = JSON.parse(data.pReceive);
                        let p_pz_A = JSON.parse(data.pPangzhanA);
                        $("#numReceive").text(data.numReceive + " m³");
                        $("#pReceive").text(p_receive.name + "(" + p_receive.phone + ")");
                        $("#pPangzhanA").text(p_pz_A.name + "(" + p_pz_A.phone + ")");
                    }
                    // if (status == 5) {
                    //     let p_pa_B = JSON.parse(data.pPangzhanB);
                    //     $("#pPangzhanB").text(p_pa_B.name + "(" + p_pa_B.phone + ")");
                    // }
                }
            });
        }
    }

</script>
</body>
</html>