<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.muqing.dao.ArticleDao">

    <sql id="where">
        <where>
            <if test="params.type != null and params.type != ''">
                and type = #{params.type}
            </if>
            <if test="params.status != null and params.status != ''">
                and status = #{params.status}
            </if>
            <if test="params.title != null and params.title != ''">
                and t.title like concat('%', #{params.title}, '%')
            </if>
        </where>
    </sql>

    <select id="count" resultType="int">
        select count(1) from t_article t
        <include refid="where"/>
    </select>

    <select id="list" resultType="com.muqing.model.Article">
        select id,type,title,publishTime,isTop,status,readCount,createTime,updateTime from t_article t
        <include refid="where"/>
        ${params.orderBy}
        limit #{offset}, #{limit}
    </select>

    <update id="update">
        update t_article t
        <set>
            <if test="type != null">
                type = #{type},
            </if>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="content != null">
                content = #{content},
            </if>
            <if test="publishTime != null">
                publishTime = #{publishTime},
            </if>
            <if test="isTop != null">
                isTop = #{isTop},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            updateTime = now()
        </set>
        where t.id = #{id}
    </update>

    <update id="increaseReadCount" parameterType="java.lang.Long">
    update t_article
    set
        readCount = readCount + 1
    where
        id = #{questionId,jdbcType=BIGINT}
  </update>

</mapper>
